using Application.Options;
using Infrastructure.QrApi;
using System;
using System.IO;
using System.Linq;
using System.Reflection;
using Xunit;

namespace InfrastructureTests
{
    public class QrServiceTest
    {
        private string shc0 = "shc:/5676290952432060346029243740446031222959532654603460292540772804336028702864716745222809286133314564376531415906402203064504590856435503414245413640370636654171372412363803043756220467374075323239254334433260573601104135315371707424357641442772411240663904106925305522643028662239436667573022677154422223072662593160265069051040586653556729535372412542272807347771231040262520214003325352597669313666627623243907053027377040606311273929112530534126232922550058592053735636254154430844576960107775434022734437682306274328633850236576654134006444704425035376326209084355532507255234320952770928092976256344293828110405686024507126715709343231266539303511395742213221565039352205286327564365520304276438235525693931404464362437003710323636095704581254241121595408764142343627002540755859542429300777385520047231272709322529714144004253576560266809433052742603697142333321272453630670535868456562753007006710765555060563226258352362237669676159374477203050585240654155756460317036623777653541457726365432406343541234106409122542703074265928284054367261201075340761280557412238644375556639730045687605503342043065371112390853545264450327416456745723070630572308045245502629233035265037665645756103746562293203032769257512116732253441664370083452215650554245337710382257257611380525706523561138746825613208776604682541667075703443717538560309284200003475226876300832432132290565542753000963762867500354763741287265660462506752376520345657734221046311012956700425035971395242610828341211104055727356093940666274362629371266572500576155363856442208397107506506342939404333344238242022555528345006722659366167105942702770222220";

        [Fact]
        public async void GetQrCodeAsyncTest()
        {
            var assembly = Assembly.GetExecutingAssembly();
            var resourceName = "InfrastructureTests.QrCodeApi.QRCode.png";

            byte[] image = Array.Empty<byte>();
            using (Stream stream = assembly.GetManifestResourceStream(resourceName))
            {
                using (var memstream = new MemoryStream())
                {
                    stream.CopyTo(memstream);
                    image = memstream.ToArray();
                }
            }

            byte[] pngQr = Array.Empty<byte>();
            pngQr = await (new QrService(null, new AppSettings { QrCodeApi = "" })).GetQrCodeAsync(shc0);
            Assert.True(image.SequenceEqual(pngQr));
        }
    }
}